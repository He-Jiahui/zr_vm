# 命名参数和编译期执行测试说明

本目录包含了对命名参数和编译期执行功能的测试用例。

## 测试文件说明

### 1. named_arguments.zr
**功能**: 测试命名参数的基本功能

**测试内容**:
- 基本命名参数调用
- 位置参数和命名参数混合使用
- 带默认参数的函数调用
- 命名参数顺序无关性
- 复杂函数调用
- 嵌套函数调用中的命名参数

**预期结果**: 所有测试用例应该成功编译并执行

### 2. compile_time_execution.zr
**功能**: 测试编译期执行的基本功能

**测试内容**:
- 编译期变量声明和使用
- 编译期函数声明和调用
- 编译期表达式计算
- 编译期语句块执行
- 编译期递归调用
- 编译期条件检查
- 编译期数组大小验证
- 编译期Assert
- 编译期复杂表达式

**预期结果**: 所有测试用例应该成功编译并执行

### 3. named_arguments_errors.zr
**功能**: 测试命名参数的错误处理

**测试内容**:
- 未知参数名错误
- 重复参数名错误
- 位置参数在命名参数之后错误
- 位置参数过多错误
- 必需参数缺失错误

**预期结果**: 这些测试用例应该导致编译错误（注释掉的代码）

**注意**: 这些是错误测试用例，实际使用时需要取消注释并验证编译失败

### 4. compile_time_errors.zr
**功能**: 测试编译期执行的错误处理

**测试内容**:
- 编译期FatalError（应该阻止编译）
- 编译期Assert失败（应该阻止编译）
- 编译期访问运行时符号的写操作（应该报错）
- 编译期访问不存在的标识符（应该报错）
- 编译期函数调用不存在的函数（应该报错）
- 编译期类型错误（应该报错）
- 编译期数组越界（应该报错）
- 编译期Info/Warning/Error级别测试
- 编译期只读访问运行时变量（应该允许）

**预期结果**: 错误测试用例应该导致编译错误（注释掉的代码）

**注意**: 这些是错误测试用例，实际使用时需要取消注释并验证编译失败

### 5. named_args_and_compile_time.zr
**功能**: 综合测试命名参数和编译期执行的结合使用

**测试内容**:
- 命名参数与编译期验证结合
- 编译期计算的函数参数
- 编译期函数用于验证命名参数

**预期结果**: 所有测试用例应该成功编译并执行

## 运行测试

### 编译测试
```bash
cd build
cmake ..
make
```

### 执行测试
```bash
./bin/zr_vm_scripts_test
```

### 单独测试某个文件
```bash
# 编译并运行特定测试文件
zr_vm_cli tests/scripts/test_cases/named_arguments.zr
```

## 测试覆盖范围

### 命名参数测试覆盖
- ✅ 位置参数和命名参数混合
- ✅ 参数名匹配错误处理
- ✅ 默认参数与命名参数结合
- ✅ 命名参数重复检测
- ✅ 参数顺序无关性

### 编译期执行测试覆盖
- ✅ 编译期函数调用
- ✅ 编译期变量访问
- ✅ 运行时符号只读访问
- ✅ 编译期错误报告（不同级别）
- ✅ 编译期递归调用
- ✅ 编译期访问运行时符号的写操作检测

## 注意事项

1. **错误测试用例**: `named_arguments_errors.zr` 和 `compile_time_errors.zr` 中的错误测试用例都是注释掉的。要测试错误处理，需要取消注释并验证编译失败。

2. **编译期执行顺序**: 编译期代码会在运行时代码之前执行，确保编译期变量和函数在运行时可用。

3. **只读访问**: 编译期代码可以读取运行时变量，但不能写入。尝试写入会导致编译错误。

4. **错误级别**: 
   - `Info`: 信息级别，不会阻止编译
   - `Warning`: 警告级别，不会阻止编译
   - `Error`: 错误级别，会阻止编译
   - `FatalError`: 致命错误，会立即停止编译

## 扩展测试

如果需要添加更多测试用例，请遵循以下格式：

```zr
module "test_name";

// 测试函数（注意：不使用function关键字）
testFunction(param1: int, param2: int): int {
    return param1 + param2;
}

// 测试用例
%test("testCaseName") {
    var result = testFunction(param2: 2, param1: 1);
    return result;
}
```

对于编译期测试：

```zr
module "compile_time_test";

%compileTime var compileTimeVar = 42;

%compileTime compileTimeFunc(x: int): int {
    return x * 2;
}

%test("compileTimeTest") {
    // 使用编译期变量或函数的结果
    return compileTimeVar;
}
```
